import React, { useState } from "react";
import ArrowDownBlue from "../../img/ArrowDownBlue.svg";
import filter from "../../img/filter.svg";
import close from "../../img/iks.svg";
import CategDropdown from "../Categories/CategDropdown";
import "../../scss/prodsMainAdapt.scss";

export default function ProdsMainAdapt({
                                           categs = [],
                                           filters = {},
                                           activeStatus,
                                           setActiveStatus,
                                           handleChange = () => {},
                                           setFilters
                                       }) {
    const [isOpen, setIsOpen] = useState(false); // отвечает за выпадалку Barchasi/.../Yangilik
    const [filt, setFilt] = useState(false);     // отвечает за выезжающую панель "Фильтры"
    const [text, setText] = useState("Barchasi");

    // Общая функция для переключения статуса
    const handleStatusChange = (newStatus, label) => {
        // Закрываем выпадашку
        setIsOpen(false);
        // Ставим текст на кнопке (Barchasi, Mahsus taklif, Yangilik)
        setText(label);
        // Меняем локальный стейт для фильтрации
        setActiveStatus(newStatus);

        // Если хотите, чтобы ещё и сервер знал о статусе,
        // вы можете параллельно вызвать handleChange:
        // (например, говорим серверу, что "offer_type" = newStatus)
        handleChange({
            target: {
                name: "offer_type",
                // когда newStatus === "all", можно передать "" или "all",
                // зависит от того, что ваш бэкенд принимает
                value: newStatus === "all" ? "" : newStatus,
            },
        });
    };

    const handleClick = () => {
        setFilters(
            {
                subcategory: '',
                min_price: '',
                max_price: '',
                search: '',
                page: 1,
            }
        )
        setActiveStatus('all');
    };

    return (
        <>
            {/* Кнопка «Фильтры» + Кнопка «Barchasi/.../Yangilik» */}
            <div className="pradapt">
                <button className="pradapt-btn" onClick={() => setFilt(true)}>
                    <img src={filter} alt=""/>
                    <p className="pradapt-btn__text">Фильтры</p>
                </button>

                <div className="pradapt-all">
                    <button className="pradapt-btn" onClick={() => setIsOpen(!isOpen)}>
                        <p className="pradapt-btn__text">{text}</p>
                        <img src={ArrowDownBlue} alt=""/>
                    </button>

                    {isOpen && (
                        <div className="pradapt-all__content">
                            <p
                                className="pradapt-all__content-text"
                                onClick={() => handleStatusChange("all", "Barchasi")}
                            >
                                Barchasi
                            </p>
                            <p
                                className="pradapt-all__content-text"
                                onClick={() => handleStatusChange("mahsus_taklif", "Mahsus taklif")}
                            >
                                Mahsus taklif
                            </p>
                            <p
                                className="pradapt-all__content-text"
                                onClick={() => handleStatusChange("yangilik", "Yangilik")}
                            >
                                Yangilik
                            </p>
                        </div>
                    )}
                </div>
            </div>
            <p className='pradapt__clear' onClick={handleClick}>
                Tozalash
            </p>

            {/* Мобильная панель «Фильтры» */}
            {filt && (
                <div className="filt">
                    <div className="filt__wrap">

                        <div className="filt__name">
                            <p className="filt__name-text">Фильтры</p>
                            <img onClick={() => setFilt(false)} src={close} alt=""/>
                        </div>

                        {/* Блок выбора категорий */}
                        <div className="filt__top">
                            <p className="filt__title">Kategoriyalar</p>
                            <div className="filt__top-cat">
                                {categs.map((cat, i) => (
                                    <CategDropdown
                                        key={i}
                                        categ={cat}
                                        filters={filters}
                                        handleChange={handleChange}
                                    />
                                ))}
                            </div>
                        </div>

                        {/* Диапазон цен */}
                        <div className="filt__bottom">
                            <p className="filt__bottom-title">Narx, So’m</p>
                            <div className="filt__inputs">
                                <input
                                    type="number"
                                    min="100"
                                    name="min_price"
                                    placeholder="от"
                                    value={filters.min_price || ""}
                                    onChange={handleChange}
                                    className="filt__inputs-inp"
                                />
                                <input
                                    type="number"
                                    min="101"
                                    name="max_price"
                                    placeholder="до"
                                    value={filters.max_price || ""}
                                    onChange={handleChange}
                                    className="filt__inputs-inp"
                                />
                            </div>
                        </div>

                    </div>
                </div>
            )}
        </>
    );
}
