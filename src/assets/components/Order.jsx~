import React, { useState, useEffect } from 'react'
import '../scss/order.scss'
import arrow from '../img/arrowDown.svg'
import arrowUp from '../img/arrowUp.svg'

import accept from '../img/accept.svg'
import decline from '../img/declined.svg'
import inProcess from '../img/inProcess.svg'

export default function Order({ order, allOrders }) {

    const [img, setImg] = useState(inProcess)
    const [isOpen, setIsOpen] = useState(false)

    useEffect(() => {
        if (order.status == 'Yetkazib berildi') {
            setImg(accept)
        } else if (order.status == 'Bekor qilindi') {
            setImg(decline)
        } else if (order.status == 'Jarayonda') {
            setImg(inProcess)
        }
    }, []);

    return (
        <div className='order' onClick={() => { setIsOpen(!isOpen) }}>

            <div className="order__top">
                <div className="order__status">
                    <img src={img} alt="" />
                    <h1 className='order__status-text'>{order.status}</h1>
                </div>
                <div className="order__wrap">
                    <div className="order__info">
                        <div className="order__info-element">
                            <p className='order__info-element__text'>Sana</p>
                            <p className='order__info-element__title'>
                                {new Date(order.created_at).toLocaleDateString('ru-RU')}
                                <span className='order__info-element__title-span'>
                                    {new Date(order.created_at).toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit'})}
                                </span>
                            </p>
                        </div>
                        <div className="order__info-element">
                            <p className='order__info-element__text'>Buyurtma ID raqami</p>
                            <p className='order__info-element__title'>#{order.id}</p>
                        </div>
                        <div className="order__info-element">
                            <p className='order__info-element__text'>Buyurtma narxi</p>
                            <p className='order__info-element__title'>
                                {(order.total_price).toLocaleString()}  </p>
                        </div>
                    </div>
                    <div className="order__info-btn">
                        <img src={isOpen ? arrowUp : arrow} alt="" />
                    </div>
                </div>
            </div>

            {
                isOpen && (
                    <>

                        <div className="order__bottom">

                            {order.items.map((e, i) => (
                                <div key={i} className="order__bottom-prod">
                                    <div className="order__bottom-desc">
                                        <img className='order__bottom-desc__img' src={e.product.images[0].image} alt="" />
                                        <div className="order__bottom-desc__wrap">
                                            <h2 className="order__bottom-desc__title">{e.product.name}
                                                {e.product.discount > 0 ? (
                                                    <span>-{e.product.discount}%</span>
                                                ) : ('')}
                                            </h2>
                                            <p className="order__bottom-desc__text">Code {e.product.id}</p>
                                        </div>
                                    </div>
                                    <div className="order__bottom-price">
                                        <p className="order__bottom-price__title">Maxsulot narxi</p>
                                        <p className="order__bottom-price__text">
                                            {Number(e.product.discount) > 0 ? (
                                                <span>{Number(e.product.price).toLocaleString()} so'm</span>
                                            ) : ('')}
                                            {(e.product.price - (e.product.price * e.product.discount / 100)).toLocaleString()} so'm
                                        </p>
                                    </div>
                                </div>

                            ))}


                        </div>
                        <div className="order__bottomadapt">
                            {order.items.map((e, i) => (
                                <div key={i} className="order__bottomadapt-prod">
                                    <img src={e.product.images[0].image} alt="" />
                                    <div className="order__bottomadapt-desc">

                                        <div className="order__bottomadapt-desc__wrap">
                                            <h2 className="order__bottomadapt-desc__title">{e.product.name}
                                                {e.product.discount > 0 ? (
                                                    <span>-{e.product.discount}%</span>
                                                ) : ('')}
                                            </h2>
                                            <p className="order__bottomadapt-desc__text">Code {e.product.id}</p>
                                        </div>
                                        <div className="order__bottomadapt-price">
                                            <p className="order__bottomadapt-price__title">Maxsulot narxi</p>
                                            <p className="order__bottomadapt-price__text">
                                                {Number(e.product.discount) > 0 ? (
                                                    <span>{Number(e.product.price).toLocaleString()} so'm</span>
                                                ) : ('')}
                                                {(e.product.price - (e.product.price * e.product.discount / 100)).toLocaleString()} so'm
                                            </p>
                                        </div>
                                    </div>

                                </div>

                            ))}
                        </div>
                    </>

                )
            }

        </div >
    )
}
